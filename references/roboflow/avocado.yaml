src_dir: ../../

default_target: icam-540
supported_targets:
- icam-540

distro:
  version: 0.1.0
  channel: apollo-edge

runtime:
  dev:
    dependencies:
      avocado-runtime: '{{ config.distro.version }}'
      roboflow:
        ext: roboflow
      config-dev:
        ext: config
      avocado-ext-dev:
        ext: avocado-ext-dev
        vsn: '*'
      avocado-ext-sshd-dev:
        ext: avocado-ext-sshd-dev
        vsn: '*'


      nvidia-docker:
        ext: nvidia-docker

    icam-540:
      dependencies:
        avocado-bsp-icam-540:
          ext: avocado-bsp-icam-540
          vsn: '*'
        avocado-img-tegraflash: '*'

provision:
  tegraflash:
    container_args:
    - -v
    - /dev:/dev
    - -v
    - /sys:/sys
    - --privileged

ext:
  config:
    version: 0.1.0

    users:
      root:
        password: ''

  nvidia-docker:
    version: 0.1.0

    enable_services:
    - docker.service

    on_merge:
    - systemctl restart --no-block docker.service

    dependencies:
      ca-certificates: '*'
      iptables-modules: '*'
      kernel-module-ip-tables: '*'
      kernel-module-ip6table-filter: '*'
      kernel-module-ip6table-mangle: '*'
      kernel-module-ip6table-nat: '*'
      kernel-module-iptable-filter: '*'
      kernel-module-iptable-mangle: '*'
      kernel-module-iptable-nat: '*'
      kernel-module-iptable-raw: '*'
      kernel-module-nf-conntrack-netlink: '*'
      kernel-module-nf-nat: '*'
      kernel-module-xt-addrtype: '*'
      kernel-module-xt-conntrack: '*'
      kernel-module-xt-masquerade: '*'
      nvidia-docker: '*'

  roboflow:
    version: 0.1.0

    overlay: overlay

    enable_services:
    - roboflow.service

    on_merge:
    - systemctl restart --no-block roboflow.service
    - nvbootctrl verify

    dependencies:
      coreutils: '*'
      curl: '*'
      glibc-utils: '*'
      logrotate: '*'
      openssl-bin: '*'
      p11-kit: '*'
      pylon: '*'
      pylon-dev: '*'
      python3-pypylon: '*'
      rfdm:
        compile: rfdm
        install: rfdm-install.sh
      tegra-redundant-boot-base: '*'
      tegra-tools: '*'
      usbutils: '*'
      util-linux: '*'
      v4l-utils: '*'

sdk:
  image: docker.io/avocadolinux/sdk:{{ config.distro.channel }}

  container_args:
  - --network=host
  - --privileged
  - -v /dev:/dev
  - -v /sys:/sys

  compile:
    rfdm:
      compile: rfdm-fetch.sh

  dependencies:
    avocado-sdk-toolchain: '*'
    nativesdk-avocado-hitl: '*'
    nativesdk-openssh-scp: '*'
    nativesdk-openssh-ssh: '*'
    nativesdk-rsync: '*'
    nativesdk-util-linux-mount: '*'
