supported_targets: '*'

distro:
  release: 2024
  channel: edge

runtimes:
  dev:
    packages:
      avocado-runtime: '*'
    extensions:
      - example-rust
      - config-dev
      - avocado-ext-dev
      - avocado-ext-sshd-dev
      - avocado-bsp-{{ avocado.target }}

extensions:
  avocado-ext-dev:
    source:
      type: package
      version: '*'

  avocado-ext-sshd-dev:
    source:
      type: package
      version: '*'

  avocado-bsp-{{ avocado.target }}:
    source:
      type: package
      version: '*'

  config-dev:
    version: 0.1.0

    users:
      root:
        password: ''

  example-rust:
    version: 0.1.0

    overlay: overlay

    enable_services:
      - ref-rust.service

    on_merge:
      - systemctl restart --no-block ref-rust.service

    on_unmerge:
      - systemctl stop ref-rust.service

    packages:
      example-rust-app:
        compile: example-rust-app
        install: rust-install.sh

    sdk:
      packages:
        nativesdk-binutils: '*'
        nativesdk-cargo: '*'
        nativesdk-gcc: '*'
        nativesdk-glibc-dev: '*'
        nativesdk-libgcc-dev: '*'
        nativesdk-rust: '*'
        packagegroup-rust-cross-canadian-avocado-{{ avocado.target }}: '*'

sdk:
  image: docker.io/avocadolinux/sdk:{{ avocado.distro.release }}-{{ avocado.distro.channel }}

  container_args:
    - --network=host
    - --privileged
    - -v /dev:/dev
    - -v /sys:/sys

  compile:
    example-rust-app:
      compile: rust-compile.sh

  packages:
    avocado-sdk-toolchain: '*'
