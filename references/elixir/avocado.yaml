supported_targets: '*'

distro:
  version: 0.1.0
  channel: apollo-edge

runtimes:
  dev:
    packages:
      avocado-runtime: '{{ avocado.distro.version }}'
    extensions:
      - example-elixir
      - config-dev
      - avocado-ext-dev
      - avocado-ext-sshd-dev
      - avocado-ext-webkit
      - avocado-bsp-{{ avocado.target }}

extensions:
  config-dev:
    version: 0.1.0

    users:
      root:
        password: ''

  example-elixir:
    version: 0.1.0

    overlay: overlay

    enable_services:
    - ref-elixir.service

    on_merge:
    - systemctl restart --no-block ref-elixir.service
    - systemctl restart --no-block cog.service

    packages:
      example-elixir-app:
        compile: example-elixir-app
        install: elixir-install.sh

    sdk:
      packages:
        nativesdk-ca-certificates: '*'
        nativesdk-elixir: '*'
        nativesdk-elixir-eex: '*'
        nativesdk-elixir-ex-unit: '*'
        nativesdk-elixir-mix: '*'
        nativesdk-erlang: '*'
        nativesdk-erlang-asn1: '*'
        nativesdk-erlang-crypto: '*'
        nativesdk-erlang-dev: '*'
        nativesdk-erlang-inets: '*'
        nativesdk-erlang-parsetools: '*'
        nativesdk-erlang-public-key: '*'
        nativesdk-erlang-public-key-dev: '*'
        nativesdk-erlang-runtime-tools: '*'
        nativesdk-erlang-ssl: '*'
        nativesdk-erlang-stdlib: '*'
        nativesdk-erlang-xmerl: '*'
        nativesdk-erlang-xmerl-dev: '*'
        nativesdk-git: '*'
        nativesdk-nodejs: '*'
        nativesdk-rebar3: '*'

sdk:
  image: docker.io/avocadolinux/sdk:{{ avocado.distro.channel }}

  container_args:
  - --privileged
  - --network=host
  - -v /dev:/dev
  - -v /sys:/sys

  compile:
    example-elixir-app:
      compile: elixir-compile.sh
      packages:
        erlang-erts: '*'

  packages:
    avocado-sdk-toolchain: '{{ avocado.distro.version }}'
    nativesdk-avocado-ext-dev: '*'
